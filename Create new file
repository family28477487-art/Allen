<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九州自駕遊：熊本 & 福岡編輯版</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #F1F5F9; margin: 0; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .app-container { max-width: 500px; margin: 0 auto; min-height: 100vh; background: #F1F5F9; position: relative; }
        .main-content { background: white; border-radius: 40px 40px 0 0; min-height: calc(100vh - 210px); }
        input, select, textarea { font-size: 16px !important; }
        .tab-active { background-color: #2563eb; color: white; transform: scale(1.1); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4); }
    </style>
</head>
<body>
    <div id="app" class="app-container shadow-2xl">
        
        <div class="relative h-[250px] overflow-hidden">
            <img src="banner.jpg" class="w-full h-full object-cover" alt="九州自駕遊">
            <div class="absolute right-4 bottom-14 flex space-x-2 z-20">
                <button v-for="tab in tabs" @click="activeTab = tab.id" 
                    :class="activeTab === tab.id ? 'tab-active' : 'bg-white/90 text-blue-600'"
                    class="w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 backdrop-blur-sm">
                    <i :class="tab.icon" class="text-xl"></i>
                </button>
            </div>
        </div>

        <div class="main-content relative z-10 -mt-10 px-5 pt-8 pb-32">
            
            <div v-if="activeTab === 'schedule'">
                <div class="flex justify-between items-center mb-5">
                    <h1 class="text-2xl font-bold text-slate-800">{{ days[activeDayIndex].city }} 行程</h1>
                    <button @click="resetToDefault" class="text-[10px] text-slate-400 border px-2 py-1 rounded">重置預設行程</button>
                </div>

                <div class="flex overflow-x-auto space-x-3 pb-5 hide-scrollbar">
                    <div v-for="(d, index) in days" :key="index" @click="activeDayIndex = index"
                        :class="activeDayIndex === index ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-slate-400'"
                        class="min-w-[70px] p-3 rounded-2xl text-center cursor-pointer transition-all border border-slate-100">
                        <div class="text-[10px] uppercase font-bold">{{ d.week }}</div>
                        <div class="text-xl font-bold">{{ d.date }}</div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div v-for="(item, idx) in filteredItems" :key="item.id" class="relative">
                        <div v-if="idx > 0" class="flex items-center ml-8 -mt-2 mb-2 text-slate-300 text-[11px]">
                            <div class="border-l-2 border-dashed border-slate-200 h-6 mr-3"></div>
                            <i class="fa-solid fa-car-side mr-2"></i>約 {{ item.travelTime || '15分' }}
                        </div>

                        <div class="bg-white border border-slate-100 p-4 rounded-2xl shadow-sm relative">
                            <div class="flex justify-between items-start">
                                <span :class="catStyle(item.category)" class="text-[10px] font-bold px-2 py-1 rounded-md">{{ item.category }}</span>
                                <div class="flex space-x-3">
                                    <button @click="openModal(item)" class="text-slate-300 hover:text-blue-500"><i class="fa-solid fa-pen"></i></button>
                                    <button @click="deleteItem(item.id)" class="text-slate-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                                    <button @click="goNav(item.title)" class="text-blue-500"><i class="fa-solid fa-location-arrow"></i></button>
                                </div>
                            </div>
                            <h3 class="font-bold text-slate-800 mt-2 text-lg">{{ item.title }}</h3>
                            <div class="mt-1 text-xs text-slate-400 font-medium">
                                <i class="fa-regular fa-clock mr-1"></i>{{ item.time }}
                                <span v-if="item.price" class="ml-3"><i class="fa-solid fa-ticket mr-1"></i>{{ item.price }} JPY</span>
                            </div>
                            <p v-if="item.note" class="mt-2 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg italic">"{{ item.note }}"</p>
                        </div>
                    </div>
                </div>
            </div>

            <div v-else-if="activeTab === 'info'" class="space-y-6">
                <h1 class="text-2xl font-bold text-slate-800">⚙️ 旅行設定</h1>
                
                <div class="bg-white border p-5 rounded-2xl shadow-sm space-y-4">
                    <h2 class="text-sm font-bold text-blue-600"><i class="fa-solid fa-plane mr-2"></i>航班資訊編輯</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <input v-model="flight.dep" placeholder="去程航班" class="bg-slate-50 p-3 rounded-xl text-sm border-none">
                        <input v-model="flight.depTime" type="time" class="bg-slate-50 p-3 rounded-xl text-sm border-none">
                        <input v-model="flight.arr" placeholder="回程航班" class="bg-slate-50 p-3 rounded-xl text-sm border-none">
                        <input v-model="flight.arrTime" type="time" class="bg-slate-50 p-3 rounded-xl text-sm border-none">
                    </div>
                </div>

                <div class="bg-white border p-5 rounded-2xl shadow-sm space-y-3">
                    <h2 class="text-sm font-bold text-blue-600"><i class="fa-solid fa-map mr-2"></i>每日城市編輯</h2>
                    <div v-for="(day, i) in days" :key="i" class="flex items-center space-x-2 border-b pb-2 last:border-0">
                        <span class="text-xs font-bold text-slate-300 w-6">D{{i+1}}</span>
                        <input v-model="day.date" class="bg-slate-50 rounded-lg p-2 text-xs w-16 border-none">
                        <input v-model="day.city" class="bg-slate-50 rounded-lg p-2 text-xs flex-grow border-none">
                        <input v-model="day.week" class="bg-slate-50 rounded-lg p-2 text-xs w-10 border-none">
                    </div>
                </div>

                <div class="bg-blue-600 p-5 rounded-3xl text-white shadow-lg">
                    <div class="text-xs opacity-70 mb-2">日幣換算 (1 JPY = 0.21 TWD)</div>
                    <div class="flex items-center space-x-4">
                        <input type="number" v-model="jpy" class="bg-white/20 rounded-xl p-3 w-full text-white placeholder-white/50 border-none" placeholder="輸入日幣">
                        <i class="fa-solid fa-arrow-right"></i>
                        <div class="text-xl font-bold">NT${{ Math.round(jpy * 0.21) }}</div>
                    </div>
                </div>
            </div>

            <div v-else class="text-center py-20 text-slate-300">功能開發中...</div>
        </div>

        <button @click="openModal()" class="fixed bottom-8 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center text-xl z-50 active:scale-90 transition-transform">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-end sm:items-center justify-center p-4">
            <div class="bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl font-bold text-slate-800">{{ isEditing ? '修改行程' : '新增行程' }}</h2>
                    <button @click="showModal = false" class="text-slate-400"><i class="fa-solid fa-times-circle text-xl"></i></button>
                </div>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <select v-model="form.category" class="bg-slate-50 rounded-xl p-3 text-sm border-none">
                            <option v-for="c in ['景點','美食','住宿','航班','租車','購物','其他']" :value="c">{{c}}</option>
                        </select>
                        <input type="time" v-model="form.time" class="bg-slate-50 rounded-xl p-3 text-sm border-none">
                    </div>
                    <input v-model="form.title" placeholder="景點名稱" class="w-full bg-slate-50 rounded-xl p-3 text-sm border-none">
                    <div class="grid grid-cols-2 gap-3">
                        <input v-model="form.travelTime" placeholder="交通時間(如20分)" class="bg-slate-50 rounded-xl p-3 text-sm border-none">
                        <input v-model="form.price" type="number" placeholder="門票(JPY)" class="bg-slate-50 rounded-xl p-3 text-sm border-none">
                    </div>
                    <textarea v-model="form.note" placeholder="備註內容" class="w-full bg-slate-50 rounded-xl p-3 text-sm border-none" rows="2"></textarea>
                    <button @click="saveItem" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-transform">儲存行程</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, watch } = Vue;
        createApp({
            setup() {
                const activeTab = ref('schedule');
                const activeDayIndex = ref(0);
                const jpy = ref('');
                const showModal = ref(false);
                const isEditing = ref(false);
                const editingId = ref(null);

                const tabs = [
                    { id: 'schedule', icon: 'fa-solid fa-calendar-alt' },
                    { id: 'info', icon: 'fa-solid fa-sliders' },
                    { id: 'shop', icon: 'fa-solid fa-bag-shopping' },
                    { id: 'cost', icon: 'fa-solid fa-wallet' }
                ];

                // 1. 預設資料 (熊本 & 福岡)
                const defaultDays = [
                    { date: '12/28', week: 'Sun', city: '熊本' },
                    { date: '12/29', week: 'Mon', city: '熊本' },
                    { date: '12/30', week: 'Tue', city: '福岡' },
                    { date: '12/31', week: 'Wed', city: '福岡' },
                    { date: '01/01', week: 'Thu', city: '福岡' }
                ];

                const defaultItems = [
                    { id: 1, dayIdx: 0, category: '航班', title: '福岡機場 (FUK)', time: '12:45', note: '抵達九州', travelTime: '-', price: '' },
                    { id: 2, dayIdx: 0, category: '租車', title: '取車：博多站前', time: '14:00', note: '前往熊本', travelTime: '1.5小時', price: '' },
                    { id: 3, dayIdx: 0, category: '景點', title: '熊本城 (夜間)', time: '18:00', note: '點燈非常漂亮', travelTime: '20分', price: '800' },
                    { id: 4, dayIdx: 1, category: '景點', title: '水前寺成趣園', time: '10:00', note: '日式庭園美景', travelTime: '30分', price: '400' },
                    { id: 5, dayIdx: 1, category: '美食', title: '勝烈亭 豬排', time: '12:30', note: '熊本必吃美食', travelTime: '15分', price: '2500' },
                    { id: 6, dayIdx: 2, category: '景點', title: '太宰府天滿宮', time: '11:00', note: '賞梅與學問之神', travelTime: '1小時', price: '' },
                    { id: 7, dayIdx: 3, category: '購物', title: '天神地下街', time: '14:00', note: '福岡最大購物區', travelTime: '20分', price: '' },
                    { id: 8, dayIdx: 4, category: '景點', title: 'Lalaport 福岡', time: '11:00', note: '看 1:1 鋼彈', travelTime: '30分', price: '' }
                ];

                // 2. 初始化 LocalStorage
                const days = ref(JSON.parse(localStorage.getItem('qz_days')) || defaultDays);
                const items = ref(JSON.parse(localStorage.getItem('qz_items')) || defaultItems);
                const flight = ref(JSON.parse(localStorage.getItem('qz_flight')) || { dep:'CI116', depTime:'09:30', arr:'CI117', arrTime:'18:00' });

                // 3. 監聽變動並儲存
                watch([days, items, flight], () => {
                    localStorage.setItem('qz_days', JSON.stringify(days.value));
                    localStorage.setItem('qz_items', JSON.stringify(items.value));
                    localStorage.setItem('qz_flight', JSON.stringify(flight.value));
                }, { deep: true });

                const filteredItems = computed(() => {
                    return items.value.filter(i => i.dayIdx === activeDayIndex.value).sort((a,b) => a.time.localeCompare(b.time));
                });

                // 4. 功能函數
                const openModal = (item = null) => {
                    if(item) {
                        isEditing.value = true;
                        editingId.value = item.id;
                        form.value = { ...item };
                    } else {
                        isEditing.value = false;
                        form.value = { category:'景點', title:'', time:'10:00', note:'', price:'', travelTime:'' };
                    }
                    showModal.value = true;
                };

                const saveItem = () => {
                    if(!form.value.title) return alert('請輸入景點名稱');
                    if(isEditing.value) {
                        const idx = items.value.findIndex(i => i.id === editingId.value);
                        items.value[idx] = { ...form.value };
                    } else {
                        items.value.push({ ...form.value, id: Date.now(), dayIdx: activeDayIndex.value });
                    }
                    showModal.value = false;
                };

                const deleteItem = (id) => confirm('確定刪除？') && (items.value = items.value.filter(i => i.id !== id));
                const resetToDefault = () => confirm('將重置回預設行程？') && (localStorage.clear(), location.reload());
                const goNav = (t) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t)}`, '_blank');
                const catStyle = (c) => ({
                    '景點':'bg-green-50 text-green-600', '美食':'bg-orange-50 text-orange-600',
                    '住宿':'bg-blue-50 text-blue-600', '航班':'bg-indigo-50 text-indigo-600'
                }[c] || 'bg-slate-50 text-slate-500');

                const form = ref({});
                const showModal = ref(false);

                return { 
                    activeTab, activeDayIndex, tabs, days, filteredItems, flight, jpy, 
                    showModal, isEditing, form, openModal, saveItem, deleteItem, 
                    resetToDefault, goNav, catStyle 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
